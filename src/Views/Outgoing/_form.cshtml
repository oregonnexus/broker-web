@model OregonNexus.Broker.Web.ViewModels.OutgoingRequests.CreateOutgoingRequestViewModel
@using static OregonNexus.Broker.Web.Constants.Claims.CustomClaimType;

<div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl">
  <header class="relative isolate">
    <div class="absolute inset-0 -z-10 overflow-hidden" aria-hidden="true">
      <div class="absolute left-16 top-full -mt-16 transform-gpu opacity-50 blur-3xl xl:left-1/2 xl:-ml-80">
        <div class="aspect-[1154/678] w-[72.125rem] bg-gradient-to-br from-secondary-500 to-secondary-100" style="clip-path: polygon(100% 38.5%, 82.6% 100%, 60.2% 37.7%, 52.4% 32.1%, 47.5% 41.8%, 45.2% 65.6%, 27.5% 23.4%, 0.1% 35.3%, 17.9% 0%, 27.7% 23.4%, 76.2% 2.5%, 74.2% 56%, 100% 38.5%)"></div>
      </div>
      <div class="absolute inset-x-0 bottom-0 h-px bg-gray-900/5"></div>
    </div>

    <div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
      <div class="mx-auto flex max-w-2xl items-center justify-between gap-x-8 lg:mx-0 lg:max-w-none">
        <div class="flex items-center gap-x-6">
          <img src="~/images/Final-Education-Nexus-ICON-png.png" alt="@Model.FromDistrict" class="h-16 w-16 flex-none rounded-full ring-1 ring-gray-900/10">
          <h1>
            <div class="text-sm leading-6 text-gray-500">Student Unique ID: <span class="text-gray-700">@Model.StudentUniqueId</span></div>
            <div class="mt-1 text-base font-semibold leading-6 text-gray-900">@Model.FirstName @Model.MiddleName @Model.LastSurname</div>
          </h1>
        </div>
        <div class="flex items-center gap-x-4 sm:gap-x-6">
          <a
            asp-controller="Outgoing"
            asp-action="Index"
            asp-authorize
            asp-policy="@TransferOutgoingRecords"
            class="text-sm font-semibold leading-6 text-gray-900"
          >
            Back to list
          </a>
        </div>
      </div>
    </div>
  </header>

  <div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
    <div class="mx-auto grid grid-cols-l grid-rows-1 max-w-2xl items-start gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-4">

      <div class="-mx-4 px-4 py-8 shadow-sm ring-1 ring-gray-900/5 sm:mx-0 sm:rounded-lg sm:px-8 sm:pb-14 lg:col-span-3 xl:px-16 xl:pb-20 xl:pt-16">
        <h2 class="text-base font-semibold leading-6 text-gray-900">Request</h2>
        <dl class="mt-6 grid grid-cols-1 text-sm leading-6 sm:grid-cols-2">
          <div class="sm:pr-4 sm:col-span-2">
            <dt class="inline text-gray-500">Requested on</dt>
            <dd class="inline text-gray-700"><time datetime="@Model.Date">@Model.Date</time></dd>
          </div>
          <div class="mt-6 border-t border-gray-900/5 pt-6 sm:pr-4">
            <dt class="font-semibold text-gray-900">Receiving School</dt>
            <dd class="mt-2 text-gray-500"><span class="font-medium text-gray-900">@Model.ToDistrict / @Model.ToSchool</span></dd>
          </div>
          <div class="mt-6 border-t border-gray-900/5 pt-6 sm:pr-4">
            <dt class="font-semibold text-gray-900">Clerk's Email</dt>
            <dd class="mt-2 text-gray-500"><span class="font-medium text-gray-900">@Model.ToEmail</span></dd>
          </div>
          <div class="mt-6 border-t border-gray-900/5 pt-6 sm:pr-4 sm:col-span-2">
            <dt class="font-semibold text-gray-900">Notes</dt>
            <dd class="mt-2 text-gray-500"><span class="font-medium text-gray-900">@Model.Note</span></dd>
          </div>
        </dl>
        <table class="mt-16 w-full whitespace-nowrap text-left text-sm leading-6">
          <colgroup>
            <col class="w-full">
            <col>
            <col>
            <col>
          </colgroup>
          <thead class="border-b border-gray-200 text-gray-900">
            <tr>
              <th scope="col" class="px-0 py-3 font-semibold">Files</th>
            </tr>
          </thead>
          <tbody>
            @for (var i = 0; i < 5; i++)
            {
              <tr class="border-b border-gray-100">
                <td class="max-w-0 px-0 py-5 align-top">
                  <a href="#" class="text-sm leading-6 text-tertiary-600">Test.pdf</a>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="lg:col-span-1">
        <h2 class="text-sm font-semibold leading-6 text-gray-900">Messages</h2>
        <ul role="list" class="mt-6 space-y-6">
          <li class="relative flex gap-x-4">
            <div class="absolute left-0 top-0 flex w-6 justify-center -bottom-6">
              <div class="w-px bg-gray-200"></div>
            </div>
            <div class="relative flex h-6 w-6 flex-none items-center justify-center bg-white">
              <div class="h-1.5 w-1.5 rounded-full bg-gray-100 ring-1 ring-gray-300"></div>
            </div>
            <p class="flex-auto py-0.5 text-xs leading-5 text-gray-500"><span class="font-medium text-gray-900">Luis Ruiz</span> created the request.</p>
            <time datetime="2023-01-23T10:32" class="flex-none py-0.5 text-xs leading-5 text-gray-500">2d ago</time>
          </li>
          <li class="relative flex gap-x-4">
            <div class="absolute left-0 top-0 flex w-6 justify-center -bottom-6">
              <div class="w-px bg-gray-200"></div>
            </div>
            <div class="relative flex h-6 w-6 flex-none items-center justify-center bg-white">
              <div class="h-1.5 w-1.5 rounded-full bg-gray-100 ring-1 ring-gray-300"></div>
            </div>
            <div class="flex-auto rounded-md p-3 ring-1 ring-inset ring-gray-200">
              <div class="flex justify-between gap-x-4">
                <div class="py-0.5 text-xs leading-5 text-gray-500"><span class="font-medium text-gray-900">Luis Ruiz</span> commented</div>
                <time datetime="2023-01-23T15:56" class="flex-none py-0.5 text-xs leading-5 text-gray-500">1d ago</time>
              </div>
              <p class="text-sm leading-6 text-gray-500">Called student, they reassured me the forms would be ready by the 30th.</p>
            </div>
          </li>
        </ul>

        <div class="mt-6 flex gap-x-3">
          <div class="absolute left-0 top-0 flex w-6 justify-center -bottom-6">
            <div class="w-px bg-gray-200"></div>
          </div>
          <div class="relative flex h-6 w-6 flex-none items-center justify-center bg-white">
            <div class="h-1.5 w-1.5 rounded-full bg-gray-100 ring-1 ring-gray-300"></div>
          </div>
          <div class="relative grid gap-2 flex-1">
            <div class="overflow-hidden rounded-lg pb-12 shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-tertiary-600">
              <label for="message" class="sr-only">Add your message</label>
              <textarea id="message" class="block w-full resize-none border-0 bg-transparent py-1.5 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6" placeholder="Add your message..."></textarea>
            </div>
            <div class="text-right">
              <button type="button" class="rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">Message</button>
            </div>
          </div>
        </div>
      </div>

      <div class="lg:col-span-4">
        <h2 class="sr-only">Student Lookup Summary</h2>
        <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5 p-6"">
          <div>
            <h2 class="text-base font-semibold leading-7 text-gray-900">Student lookup</h2>
            <p class="mt-1 text-sm leading-6 text-gray-600">Provide information about the student to conduct a lookup and find a match.</p>
          </div>
          <div class="grid grid-cols-1 gap-6 sm:grid-cols-6">
            <div class="sm:col-span-2">
              <label for="firstName" class="block text-sm font-medium leading-6 text-gray-900">
                First Name
              </label>
              <div class="mt-2">
                <input
                  id="firstName"
                  x-model="firstName"
                  type="text"
                  class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-tertiary-700 sm:text-sm sm:leading-6"
                >
              </div>
            </div>
            <div class="sm:col-span-2">
              <label for="lastSurname" class="block text-sm font-medium leading-6 text-gray-900">
                Last Name
              </label>
              <div class="mt-2">
                <input
                  id="lastSurname"
                  x-model="lastSurname"
                  type="text"
                  class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-tertiary-700 sm:text-sm sm:leading-6"
                >
              </div>
            </div>
            <div class="sm:col-span-2">
              <label for="birthDate" class="block text-sm font-medium leading-6 text-gray-900">
                Birth Date
              </label>
              <div class="mt-2">
                <input
                  id="birthDate"
                  x-model="birthDate"
                  type="date"
                  class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-tertiary-700 sm:text-sm sm:leading-6"
                >
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 gap-6 sm:grid-cols-6">
            <div class="sm:col-span-6 text-right">
              <button
                type="button"
                class="rounded-md bg-tertiary-700 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-tertiary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-tertiary-700"
                @@click="findStudents"
              >
                Find student
              </button>
            </div>
          </div>
          <template x-if="studentsError">
            <p class="mt-2 text-sm text-caution-700" x-text="studentsError"></p>
          </template>
          <div x-show="students.length > 0" class="grid grid-cols-1 gap-6 sm:grid-cols-6">
            <div class="sm:col-span-6">
              <div class="mt-4 grid grid-cols-1 gap-y-6 sm:grid-cols-3 sm:gap-x-4">
                <template
                  x-for="student in students"
                  :key="student.studentUniqueId"
                >
                  <label
                    :for="`student-studentUniqueId-${student.studentUniqueId}`"
                    :class="studentUniqueId === student.studentUniqueId ? 'border-tertiary-600 ring-2 ring-tertiary-600' : 'border-gray-300'"
                    class="relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none"
                  >
                    <input
                      :id="`student-studentUniqueId-${student.studentUniqueId}`"
                      x-model="studentUniqueId" :value="student.studentUniqueId" type="radio" class="sr-only"
                      @@change="selectStudent(student)"
                    >
                    <span class="flex flex-1">
                      <span class="flex flex-col">
                        <div
                          class="flex space-x-2 items-center text-sm font-semibold text-gray-900"
                        >
                          <span
                            class="rounded-md bg-neutral-50 px-2 py-1 text-xs font-medium text-neutral-600 ring-1 ring-inset ring-neutral-600/20"
                            x-text="student.studentUniqueId"
                          ></span>
                          <span x-text="`${student.firstName} ${student.lastSurname}`"></span>
                        </div>
                        <span
                          class="mt-3 text-sm font-medium text-gray-600"
                          x-text="`Born on ${formatDate(student.birthDate)}`"
                        ></span>
                      </span>
                    </span>
                    <svg
                      :class="studentUniqueId === student.studentUniqueId ? '' : 'invisible'"
                      class="h-5 w-5 text-tertiary-600"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      aria-hidden="true"
                    >
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                    <span
                      :class="studentUniqueId === student.studentUniqueId ? 'border border-tertiary-600' : 'border-2 border-transparent'"
                      class="pointer-events-none absolute -inset-px rounded-lg border-2" aria-hidden="true"
                    ></span>
                  </label>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5 p-4 lg:col-span-4">
        <div>
          <h2 class="text-base font-semibold leading-7 text-gray-900">Student data</h2>
        </div>
        <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5">
          <table class="min-w-full divide-y divide-gray-300">
            <thead>
              <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-3">
                  Student Unique ID
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  First Name
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Last Name
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Birth Date
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-3" x-text="matchedStudent?.studentUniqueId"></td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="matchedStudent?.firstName"></td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="matchedStudent?.lastSurname"></td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="formatDate(matchedStudent?.birthDate)"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5 p-4 lg:col-span-4">
        <div>
          <h2 class="text-base font-semibold leading-7 text-gray-900">Course Transcript</h2>
        </div>
        <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5">
          <table class="min-w-full divide-y divide-gray-300">
            <thead>
              <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-3">
                  School Year
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  School Code
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  School Name
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Course Code
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Course Title
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Att Cr
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Ern Cr
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Letter Grade
                </th>
              </tr>
            </thead>
            <tbody>
              <template x-for="(courseTranscript, index) in studentData?.courseTranscripts">
                <tr :class="index % 2 === 0 ? 'bg-gray-50': ''">
                  <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-3" x-text="courseTranscript.studentAcademicRecordReference.schoolYear"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="courseTranscript.assigningOrganizationIdentificationCode"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600">@Model.FromSchool</td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="courseTranscript.courseReference.courseCode"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="courseTranscript.academicSubjects[0].subject"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="courseTranscript.attemptedCredits"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="courseTranscript.earnedCredits"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="courseTranscript.finalLetterGradeEarned"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5 p-4 lg:col-span-4">
        <div>
          <h2 class="text-base font-semibold leading-7 text-gray-900">Program Associations</h2>
        </div>
        <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5">
          <table class="min-w-full divide-y divide-gray-300">
            <thead>
              <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-3">
                  Program Type
                </th>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-3">
                  Program Name
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  Begin Date
                </th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                  End Date
                </th>
              </tr>
            </thead>
            <tbody>
              <template x-for="(programAssociation, index) in studentData?.programAssociations">
                <tr :class="index % 2 === 0 ? 'bg-gray-50': ''">
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="programAssociation.programReference.programName"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="programAssociation.programReference.programType"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="formatDate(programAssociation.beginDate)"></td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-600" x-text="formatDate(programAssociation.endDate)"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <div class="grid gap-6 rounded-lg shadow-sm ring-1 ring-gray-900/5 p-4 lg:col-span-4">
        <div class="flex gap-2 items-end">
          <div class="flex-1">
            @Html.LabelFor(it => it.RequestStatus, new { @class = "block text-sm font-medium leading-6 text-gray-900" })
            <select asp-for="RequestStatus" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-tertiary-700 sm:text-sm sm:leading-6">
              <option value="">Select a Status</option>
              <option value="Approved">Approved</option>
              <option value="Denied">Denied</option>
            </select>
          </div>
          <div>
            <input asp-for="RequestId" type="hidden" />
            <input asp-for="EducationOrganizations" type="hidden" />
            <input asp-for="EducationOrganizationId" type="hidden" />
            <input asp-for="Date" type="hidden" />
            <input asp-for="EdfiId" type="hidden" />
            <input asp-for="EdfiStudentUniqueId" type="hidden" :value="studentUniqueId" />
            <input asp-for="Id" type="hidden" />
            <input asp-for="StudentUniqueId" type="hidden" :value="studentUniqueId" />
            <input asp-for="FirstName" type="hidden" />
            <input asp-for="MiddleName" type="hidden" />
            <input asp-for="LastSurname" type="hidden" />
            <input asp-for="FromDistrict" type="hidden" />
            <input asp-for="FromSchool" type="hidden" />
            <input asp-for="FromEmail" type="hidden" />
            <input asp-for="ToDistrict" type="hidden" />
            <input asp-for="ToSchool" type="hidden" />
            <input asp-for="ToEmail" type="hidden" />
            <input asp-for="Note" type="hidden" />
            <input asp-for="Contents" type="hidden" />
            <input asp-for="Files" type="hidden" />
            <button
              type="submit"
              class="rounded-md bg-tertiary-700 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-tertiary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-tertiary-700"
              @@click="updateRequest"
            >
              Send
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
